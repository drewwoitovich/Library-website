--DROP TABLE poll;
--DROP TABLE reading_list;
--DROP TABLE book;
--DROP TABLE forum;
--DROP TABLE [user];

CREATE TABLE [user] (
  username varchar(32) NOT NULL,
  password nvarchar(32) NOT NULL,
  is_admin bit,
  newsletter bit,
  email nvarchar(max),
  CONSTRAINT pk_username_primary_key PRIMARY KEY (username)
);

CREATE TABLE forum (
  post_id integer identity NOT NULL,
  username varchar(32) NOT NULL,
  message varchar(max) NOT NULL,
  CONSTRAINT pk_forum_primary_key PRIMARY KEY (post_id),
  CONSTRAINT fk_username_foreign_key FOREIGN KEY (username) REFERENCES [user](username)
  );

CREATE TABLE book (
  book_id integer identity NOT NULL,
  authors varchar(max) NOT NULL,
  title varchar(max) NOT NULL,
  genre varchar(max) NOT NULL,
  shelf_number integer NOT NULL,
  add_date datetime NOT NULL,
  CONSTRAINT pk_book_primary_key PRIMARY KEY (book_id)
  );

CREATE TABLE reading_list (
  username varchar(32) NOT NULL,
  book_id integer NOT NULL,
  read_status bit,

  CONSTRAINT fk_username_foreign_key FOREIGN KEY (username) REFERENCES [user](username),
  CONSTRAINT fk_book_id_foreign_key FOREIGN KEY (book_id) REFERENCES book(book_id),
  CONSTRAINT pk_reading_list_primary_key PRIMARY KEY (username, book_id)
);

CREATE TABLE poll (
  username varchar(32) NOT NULL,
  book_id_for_favorite_title integer,
  book_id_for_favorite_authors integer,
  week_of date NOT NULL,
  
  CONSTRAINT fk_book_id_for_favorite_title FOREIGN KEY (book_id_for_favorite_title) REFERENCES book(book_id),
  CONSTRAINT fk_book_id_for_favorite_authors FOREIGN KEY (book_id_for_favorite_authors) REFERENCES book(book_id),
  CONSTRAINT fk_user_username FOREIGN KEY (username) REFERENCES [user](username),
  CONSTRAINT pk_user_username_poll_week_of PRIMARY KEY (username, week_of)
);

INSERT INTO [user] (username, password, is_admin, newsletter, email) VALUES ('drew', 'password1', 0, 1, 'drew@gmail.com');
INSERT INTO [user] (username, password, is_admin, newsletter, email) VALUES ('bradon', 'password2', 1, 0, 'bradon@gmail.com');
INSERT INTO [user] (username, password, is_admin, newsletter, email) VALUES ('alyson', 'password3', 1, 1, 'alyson@gmail.com');

SET IDENTITY_INSERT forum ON;
INSERT INTO forum (post_id, username, message) VALUES (1,'drew','Hello World!');
SET IDENTITY_INSERT forum OFF;

SET IDENTITY_INSERT book ON;
INSERT INTO book (book_id, authors, title, genre, shelf_number, add_date) VALUES (1, 'Alyson Wood, Drew Woitovich', 'Turtles', 'Fiction', 2, '2018-08-09'); 
INSERT INTO book (book_id, authors, title, genre, shelf_number, add_date) VALUES (2, 'Bradon Studebaker, John Fulton', 'Cats', 'Non-Fiction', 2, '2018-08-11');
INSERT INTO book (book_id, authors, title, genre, shelf_number, add_date) VALUES (3, 'Andrew Frank, Drew Woitovich', 'Dogs', 'History', 2, '2018-08-14');
SET IDENTITY_INSERT book OFF;

INSERT INTO reading_list (username, book_id, read_status) VALUES ('drew', 2, 1);
INSERT INTO reading_list (username, book_id, read_status) VALUES ('drew', 3, 0);
INSERT INTO reading_list (username, book_id, read_status) VALUES ('bradon', 1, 0);

INSERT INTO poll (username, book_id_for_favorite_title, book_id_for_favorite_authors, week_of) VALUES ('alyson', 1, 1, '2018-08-13');
INSERT INTO poll (username, book_id_for_favorite_title, book_id_for_favorite_authors, week_of) VALUES ('drew', 2, 1, '2018-08-13');
INSERT INTO poll (username, book_id_for_favorite_title, book_id_for_favorite_authors, week_of) VALUES ('bradon', 3, 2, '2018-08-13');
INSERT INTO poll (username, book_id_for_favorite_title, book_id_for_favorite_authors, week_of) VALUES ('drew', 1, 2, '2018-08-20');
INSERT INTO poll (username, book_id_for_favorite_title, book_id_for_favorite_authors, week_of) VALUES ('bradon', 2, 3, '2018-08-20');
INSERT INTO poll (username, book_id_for_favorite_title, book_id_for_favorite_authors, week_of) VALUES ('alyson', 3, 3, '2018-08-20');